<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="noindex" />
    <link href="/admin/config.yml" type="text/yaml" rel="cms-config-url" />
    <title>Content Manager | West Valley Golf Cars</title>

    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#334843">
    <meta name="msapplication-TileColor" content="#334843">    
  </head>

  <body>
    
    <div id="nc-root"></div>

    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    <script src="https://unpkg.com/decap-cms@^3.1.2/dist/decap-cms.js"></script>

    <script>

      function genNonRepeatingNumericString(length = 8) {
        const digits = "0123456789".split("");
        let result = "";
        for (let i = 0; i < length; i++) {
          const idx = Math.floor(Math.random() * digits.length);
          result += digits.splice(idx, 1)[0];
        }
        return result;
      }

      const RandomSlugControl = createClass({
        componentDidMount: function () {
          if (this.props.value) return;
          const randomId = genNonRepeatingNumericString(8);
          this.props.onChange(randomId);
        },
        render: function () {
          const value = this.props.value || "";
          return h("input", {
            id: this.props.forID,
            className: this.props.classNameWrapper,
            type: "text",
            value: value,
            disabled: true, // lock so user cannot edit
          });
        },
      });

      CMS.registerWidget("randomSlug", RandomSlugControl);

      CMS.init({
        config: {
          backend: {
            name: "git-gateway",
            branch: "main",
          },
          media_folder: "assets",
          public_folder: "/assets",
          collections: [
            {
              name: "sales",
              label: "Carts",
              folder: "src/content/carts",
              create: true,
              slug: "{{slug}}",
              identifier_field: "name",
              extension: "md",
              fields: [
                { label: "Name", name: "name", widget: "string", required: true },
                {
                  label: "Slug",
                  name: "slug",
                  widget: "randomSlug",
                  required: true,
                  pattern: ["^[0-9]{8}$", "Slug must be exactly 8 digits."],
                  hint: "An 8-digit random ID is generated automatically on entry.",
                },
                {
                  label: "Featured",
                  name: "featured",
                  widget: "boolean",
                  hint: "Check to add to homepage",
                  required: false,
                  default: false,
                },
                { label: "Features", name: "content", widget: "markdown", required: true },
                { label: "Serial Number", name: "serial", widget: "string", required: false },
                { label: "Make", name: "make", widget: "string", required: true },
                { label: "Model", name: "model", widget: "string", required: false },
                { label: "Trim", name: "trim", widget: "string", required: false },
                {
                  label: "Year",
                  name: "year",
                  widget: "number",
                  required: true,
                  pattern: ["^[0-9]{4}$", "Year must be a 4-digit year."],
                },
                { label: "Color", name: "color", widget: "string", required: true },
                {
                  label: "Price",
                  name: "price",
                  widget: "number",
                  hint: "Don't include '$' symbol",
                  required: true,
                },
                {
                  label: "Passenger Capacity",
                  name: "passenger",
                  widget: "number",
                  required: true,
                  pattern: ["^[0-9]{1}$", "Passenger capacity must be between 1 and 9."],
                },
                {
                  label: "Condition",
                  name: "condition",
                  widget: "select",
                  options: ["New", "Used"],
                  required: true,
                },
                {
                  label: "Fuel Type",
                  name: "fuel",
                  widget: "select",
                  options: ["Gas", "Electric", "Lead Acid"],
                  required: true,
                },
                {
                  label: "Sold",
                  name: "sold",
                  widget: "boolean",
                  hint: "Check to add sold badge to listing",
                  required: false,
                  default: false,
                },
                {
                  label: "Thumbnail",
                  name: "thumbnail",
                  widget: "image",
                  hint: "This image will be displayed as the main image for the cart.",
                  allow_multiple: false,
                  required: true,
                },
                {
                  label: "Images",
                  name: "images",
                  widget: "list",
                  hint: "These images will be displayed in the gallery for the cart.",
                  required: false,
                  fields: [
                    { label: "Image", name: "image", widget: "image", required: true },
                    {
                      label: "Alt Text",
                      name: "alt",
                      widget: "string",
                      required: true,
                      hint: "Brief description of the image for screen readers.",
                    },
                  ],
                },
              ],
            },
          ],
        },
        root: "#nc-root",
      });
    </script>
  </body>
</html>
